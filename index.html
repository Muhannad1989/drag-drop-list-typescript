<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>ProjectManager</title>
    <link rel="stylesheet" href="app.css" />
    <script src="dist/app.js" defer></script>
  </head>
  <body>
    <template id="project-input">
      <!-- this.element -->
      <form>
        <div class="form-control">
          <label for="title">Title</label>
          <input type="text" id="title" />
        </div>
        <div class="form-control">
          <label for="description">Description</label>
          <textarea id="description" rows="3"></textarea>
        </div>
        <div class="form-control">
          <label for="people">People</label>
          <input type="number" id="people" step="1" min="0" max="10" />
        </div>
        <button type="submit">ADD PROJECT</button>
      </form>
      <!------------------>
    </template>
    <template id="single-project">
      <!-- this.element -->
      <li draggable="true">
        <h2></h2>
        <h3></h3>
        <p></p>
      </li>
      <!------------------>
    </template>
    <template id="project-list">
      <!-- this.element -->
      <section class="projects">
        <header>
          <h2></h2>
        </header>
        <ul></ul>
      </section>
      <!------------------>
    </template>
    <div id="app"></div>
    <script>
      'use strict';
      var __decorate =
        (this && this.__decorate) ||
        function(decorators, target, key, desc) {
          var c = arguments.length,
            r =
              c < 3
                ? target
                : desc === null
                ? (desc = Object.getOwnPropertyDescriptor(target, key))
                : desc,
            d;
          if (
            typeof Reflect === 'object' &&
            typeof Reflect.decorate === 'function'
          )
            r = Reflect.decorate(decorators, target, key, desc);
          else
            for (var i = decorators.length - 1; i >= 0; i--)
              if ((d = decorators[i]))
                r =
                  (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) ||
                  r;
          return c > 3 && r && Object.defineProperty(target, key, r), r;
        };
      var Status;
      (function(Status) {
        Status[(Status['Active'] = 0)] = 'Active';
        Status[(Status['Finished'] = 1)] = 'Finished';
      })(Status || (Status = {}));
      class Project {
        constructor(id, title, description, people, status) {
          this.id = id;
          this.title = title;
          this.description = description;
          this.people = people;
          this.status = status;
        }
      }
      class State {
        constructor() {
          this.listeners = [];
        }
        addListener(listenerFn) {
          this.listeners.push(listenerFn);
        }
      }
      class ProjectState extends State {
        constructor() {
          super();
          this.projects = [];
        }
        static getInstance() {
          if (this.instance) {
            return this.instance;
          }
          this.instance = new ProjectState();
          return this.instance;
        }
        addProject(title, description, numOfPeople) {
          const newProject = new Project(
            Math.random().toString(),
            title,
            description,
            numOfPeople,
            Status.Active,
          );
          this.projects.push(newProject);
          this.updateListeners();
        }
        moveProject(proId, newStatus) {
          const project = this.projects.find(pro => pro.id === proId);
          if (project && project.status !== newStatus) {
            project.status = newStatus;
            this.updateListeners();
          }
        }
        updateListeners() {
          for (const callFunction of this.listeners) {
            callFunction(this.projects.slice());
          }
        }
      }
      const projectState = ProjectState.getInstance();
      function validate(validatableInput) {
        let isValid = true;
        if (validatableInput.required) {
          isValid =
            isValid && validatableInput.value.toString().trim().length !== 0;
        }
        if (
          validatableInput.minLength != null &&
          typeof validatableInput.value === 'string'
        ) {
          isValid =
            isValid &&
            validatableInput.value.length >= validatableInput.minLength;
        }
        if (
          validatableInput.maxLength != null &&
          typeof validatableInput.value === 'string'
        ) {
          isValid =
            isValid &&
            validatableInput.value.length <= validatableInput.maxLength;
        }
        if (
          validatableInput.min != null &&
          typeof validatableInput.value === 'number'
        ) {
          isValid = isValid && validatableInput.value >= validatableInput.min;
        }
        if (
          validatableInput.max != null &&
          typeof validatableInput.value === 'number'
        ) {
          isValid = isValid && validatableInput.value <= validatableInput.max;
        }
        return isValid;
      }
      function autobind(_, _2, descriptor) {
        const originalMethod = descriptor.value;
        const adjDescriptor = {
          configurable: true,
          get() {
            const boundFn = originalMethod.bind(this);
            return boundFn;
          },
        };
        return adjDescriptor;
      }
      class Component {
        constructor(templateID, hostElementId, insertAtStart, newElementId) {
          this.templateElement = document.getElementById(templateID);
          this.hostElement = document.getElementById(hostElementId);
          const importedNode = document.importNode(
            this.templateElement.content,
            true,
          );
          this.element = importedNode.firstElementChild;
          if (newElementId) {
            this.element.id = newElementId;
          }
          this.attach(insertAtStart);
        }
        attach(posation) {
          this.hostElement.insertAdjacentElement(
            posation ? 'afterbegin' : 'beforeend',
            this.element,
          );
        }
      }
      class ProjectItem extends Component {
        constructor(hostId, project) {
          super('single-project', hostId, false, project.id);
          this.project = project;
          this.configure();
          this.renderContent();
        }
        dragStartHandler(event) {
          event.dataTransfer.setData('text/plain', this.project.id);
          event.dataTransfer.effectAllowed = 'move';
        }
        dragEndHandler(_) {
          console.log('end Handler');
        }
        configure() {
          this.element.addEventListener('dragstart', this.dragStartHandler);
          this.element.addEventListener('dragend', this.dragEndHandler);
        }
        get total() {
          if (this.project.people === 1) {
            return '1 person';
          } else {
            return `${this.project.people} persons`;
          }
        }
        renderContent() {
          this.element.querySelector('h2').textContent = this.project.title;
          this.element.querySelector('h3').textContent =
            this.total + ' ' + 'assigned';
          this.element.querySelector(
            'p',
          ).textContent = this.project.description;
        }
      }
      __decorate([autobind], ProjectItem.prototype, 'dragStartHandler', null);
      class ProjectList extends Component {
        constructor(type) {
          super('project-list', 'app', false, `${type}-projects`);
          this.type = type;
          this.assignedProjects = [];
          this.configure();
          this.renderContent();
        }
        dragOverHandler(event) {
          if (
            event.dataTransfer &&
            event.dataTransfer.types[0] === 'text/plain'
          ) {
            event.preventDefault();
            const listEl = this.element.querySelector('ul');
            listEl.classList.add('droppable');
          }
        }
        dropHandler(event) {
          const proId = event.dataTransfer.getData('text/plain');
          projectState.moveProject(
            proId,
            this.type === 'active' ? Status.Active : Status.Finished,
          );
        }
        dragLeaveHandler(_) {
          const listEl = this.element.querySelector('ul');
          listEl.classList.remove('droppable');
        }
        configure() {
          this.element.addEventListener('dragover', this.dragOverHandler);
          this.element.addEventListener('dragleave', this.dragLeaveHandler);
          this.element.addEventListener('drop', this.dropHandler);
          projectState.addListener(project => {
            const relaventProject = project.filter(pro => {
              if (this.type === 'active') {
                return pro.status === Status.Active;
              }
              return pro.status === Status.Finished;
            });
            this.assignedProjects = relaventProject;
            this.renderProjects();
          });
        }
        renderContent() {
          const listId = `${this.type}-projects-list`;
          this.element.querySelector('ul').id = listId;
          this.element.querySelector('h2').textContent =
            this.type.toUpperCase() + ' PROJECTS';
        }
        renderProjects() {
          const list = document.getElementById(`${this.type}-projects-list`);
          list.innerHTML = '';
          for (const item of this.assignedProjects) {
            new ProjectItem(this.element.querySelector('ul').id, item);
          }
        }
      }
      __decorate([autobind], ProjectList.prototype, 'dragOverHandler', null);
      __decorate([autobind], ProjectList.prototype, 'dropHandler', null);
      __decorate([autobind], ProjectList.prototype, 'dragLeaveHandler', null);
      class ProjectInput extends Component {
        constructor() {
          super('project-input', 'app', true, 'user-input');
          this.titleInputElement = this.element.querySelector('#title');
          this.descriptionInputElement = this.element.querySelector(
            '#description',
          );
          this.peopleInputElement = this.element.querySelector('#people');
          this.configure();
        }
        configure() {
          this.element.addEventListener('submit', this.submitHandler);
        }
        renderContent() {}
        gatherUserInput() {
          const enteredTitle = this.titleInputElement.value;
          const enteredDescription = this.descriptionInputElement.value;
          const enteredPeople = this.peopleInputElement.value;
          const titleValidatable = {
            value: enteredTitle,
            required: true,
          };
          const descriptionValidatable = {
            value: enteredDescription,
            required: true,
            minLength: 5,
          };
          const peopleValidatable = {
            value: +enteredPeople,
            required: true,
            min: 1,
            max: 5,
          };
          if (
            !validate(titleValidatable) ||
            !validate(descriptionValidatable) ||
            !validate(peopleValidatable)
          ) {
            alert('Invalid input, please try again!');
            return;
          } else {
            return [enteredTitle, enteredDescription, +enteredPeople];
          }
        }
        clearInputs() {
          this.titleInputElement.value = '';
          this.descriptionInputElement.value = '';
          this.peopleInputElement.value = '';
        }
        submitHandler(event) {
          event.preventDefault();
          const userInput = this.gatherUserInput();
          if (Array.isArray(userInput)) {
            const [title, desc, people] = userInput;
            projectState.addProject(title, desc, people);
            this.clearInputs();
          }
        }
      }
      __decorate([autobind], ProjectInput.prototype, 'submitHandler', null);
      const prjInput = new ProjectInput();
      const activePrjList = new ProjectList('active');
      const finishedPrjList = new ProjectList('finished');
      //# sourceMappingURL=app.js.map
    </script>
  </body>
</html>
